<!DOCTYPE html>
<html lang="fa" dir="rtl">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>فروشگاه | KOALAW - محصولات زیبایی رویایی</title>
  <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
  
  <style>
    @import url("https://font-face.ir/css/iransans/");

    :root {
      --primary: #e39ab4;
      /* ✨ NEW: A sharper, more vibrant pink for key UI elements */
      --primary-sharp: #d96690; 
      --secondary: #1a1a1a;
      --accent: #ffe9f2;
      --rose-gold: #f0b7c4;
      --rose-cream: #e3d1d6;
      --cream: #faf8f3;
      --deep-brown: #3d2114; /* Slightly darkened for better contrast */
      --blush: #ffd7e5;
      --lavender: #eae2ff;
      --mint: #dff8ef;
      --butter: #fff3bf;
      /* ✨ NEW: A subtle border color derived from deep-brown */
      --border-color: rgba(61, 33, 20, 0.1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      cursor: none !important
    }

    body {
      font-family: "IRANSans", sans-serif;
      font-size: 15px;
      background-color: var(--cream);
      /* ✨ CHANGED: Default text color is now high-contrast deep-brown */
      color: var(--deep-brown);
      overflow-x: hidden;
      cursor: none
    }

    .font-serif {
      font-family: "IRANSans", serif
    }

    .hide-scrollbar {
      -ms-overflow-style: none;
      scrollbar-width: none
    }

    .hide-scrollbar::-webkit-scrollbar {
      display: none
    }

    body.mobile-menu-open,
    body.filter-menu-open {
      overflow: hidden
    }

    .mobile-menu-overlay {
      position: fixed;
      inset: 0;
      background-color: rgba(0, 0, 0, .6);
      z-index: 55;
      opacity: 0;
      visibility: hidden;
      transition: opacity .4s ease, visibility .4s ease
    }

    .mobile-menu-overlay.is-active {
      opacity: 1;
      visibility: visible
    }

    #mobile-menu {
      position: fixed;
      top: 0;
      right: 0;
      width: 80%;
      max-width: 320px;
      height: 100%;
      background-color: var(--cream);
      box-shadow: -10px 0 30px rgba(0, 0, 0, .1);
      z-index: 60;
      transform: translateX(100%);
      transition: transform .4s cubic-bezier(.23, 1, .32, 1);
      display: flex;
      flex-direction: column;
      padding: 6rem 2rem 2rem;
      align-items: flex-end;
      gap: 1.25rem;
      direction: ltr;
      text-align: right
    }

    #mobile-menu.is-active {
      transform: translateX(0)
    }

    #mobile-menu .nav-link {
      font-size: 1.15rem;
      font-weight: 700;
      color: var(--deep-brown);
      width: 100%
    }

    .hamburger-button {
      width: 40px;
      height: 40px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: 5px;
      position: relative;
      z-index: 65;
      background: 0 0;
      border: none
    }

    .hamburger-button span {
      display: block;
      width: 24px;
      height: 2px;
      background-color: var(--deep-brown);
      border-radius: 2px;
      transition: transform .3s ease-in-out, opacity .3s ease-in-out;
      transform-origin: center
    }

    .hamburger-button.is-active span:nth-child(1) {
      transform: translateY(7px) rotate(45deg)
    }

    .hamburger-button.is-active span:nth-child(2) {
      opacity: 0;
      transform: scaleX(0)
    }

    .hamburger-button.is-active span:nth-child(3) {
      transform: translateY(-7px) rotate(-45deg)
    }

    .cursor {
      width: 30px;
      height: 30px;
      border: 2px solid var(--deep-brown);
      border-radius: 50% 50% 45% 45%;
      position: fixed;
      pointer-events: none;
      z-index: 9999;
      transform: translate(-50%, -50%);
      transition: border-color .2s ease, transform .2s ease
    }

    .cursor.hover {
      border-color: var(--primary-sharp)
    }

    .cursor-follower {
      width: 50px;
      height: 50px;
      background: rgba(217, 102, 144, .1);
      border-radius: 50%;
      position: fixed;
      pointer-events: none;
      z-index: 9998;
      transform: translate(-50%, -50%);
      transition: background .3s ease, transform .3s ease
    }

    nav {
      backdrop-filter: blur(20px);
      background: rgba(250, 248, 243, .85);
      box-shadow: 0 1px 20px rgba(0, 0, 0, .05)
    }

    .nav-link {
      position: relative;
      font-weight: 500;
      letter-spacing: .5px;
      transition: all .3s ease
    }

    .nav-link::before {
      content: "";
      position: absolute;
      bottom: -5px;
      right: 0;
      width: 0;
      height: 2px;
      background: linear-gradient(90deg, var(--primary-sharp), var(--rose-gold));
      transition: width .3s ease
    }

    .nav-link:hover::before {
      width: 100%
    }
    
    .product-card-v3 {
      --card-color-1: var(--blush);
      --card-color-2: var(--accent);
      position: relative;
      width: 100%;
      aspect-ratio: 3/4;
      border-radius: 24px;
      overflow: hidden;
      text-decoration: none;
      display: block;
      /* ✨ CHANGED: Added subtle border and slightly stronger shadow */
      background-color: #fff;
      border: 1px solid var(--border-color);
      box-shadow: 0 4px 15px rgba(120, 80, 100, .07);
      transition: transform .4s cubic-bezier(.175, .885, .32, 1.275), box-shadow .4s cubic-bezier(.175, .885, .32, 1.275), border-color .4s ease;
    }

    .product-card-v3:hover {
      /* ✨ CHANGED: More lift and a more prominent shadow and border on hover */
      transform: translateY(-10px);
      box-shadow: 0 20px 40px rgba(120, 80, 100, .15);
      border-color: var(--primary-sharp);
    }
    .card-bg {
      position: absolute; inset: 0;
      background: linear-gradient(160deg, var(--card-color-2), #fff 70%);
      opacity: 0.5;
    }
    .card-blob {
      position: absolute; top: -15%; right: -15%; width: 90%; height: auto;
      z-index: 1;
      animation: subtle-bob 12s ease-in-out infinite alternate;
    }
    .card-blob svg { fill: var(--card-color-1); }
    
    @keyframes subtle-bob {
      from { transform: translateY(0) rotate(0); }
      to { transform: translateY(10px) rotate(15deg); }
    }
    .card-image-wrapper {
      position: absolute;
      top: 28%; left: 50%;
      transform: translate(-50%, -50%);
      width: clamp(120px, 48%, 180px);
      aspect-ratio: 1/1;
      z-index: 3;
    }
    .card-image {
      width: 100%; height: 100%;
      object-fit: contain;
      filter: drop-shadow(0 15px 20px rgba(0,0,0,0.1));
      transition: transform .5s cubic-bezier(.175, .885, .32, 1.275);
    }
    .product-card-v3:hover .card-image {
        transform: scale(1.05) rotate(-3deg);
    }
    .card-content {
      position: absolute;
      bottom: 0; right: 0; left: 0;
      padding: 1.5rem;
      z-index: 2;
      color: var(--deep-brown);
      text-align: center;
    }
    .card-category {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      background-color: rgba(255,255,255,0.6);
      backdrop-filter: blur(5px);
      padding: 0.25rem 0.75rem;
      border-radius: 50px;
      font-size: 0.7rem;
      font-weight: 700;
      color: var(--deep-brown);
      text-transform: uppercase;
      letter-spacing: .5px;
      margin-bottom: 0.75rem;
    }
    .card-title {
      font-size: 1.1rem;
      font-weight: 800;
      line-height: 1.3;
      margin-bottom: 0.5rem;
      color: var(--deep-brown);
    }
    .card-rating {
      display: flex; align-items: center; justify-content: center;
      gap: 0.25rem; color: #f59e0b;
      margin-bottom: 0.75rem;
    }
    .card-rating svg { fill: currentColor; width: 16px; height: 16px; }
    .card-rating span { font-weight: 700; color: #a16207; font-size: 0.9rem;}
    .card-price {
      font-size: 1.25rem;
      font-weight: 700;
    }
    .product-card-v3.category-skincare { --card-color-1: var(--mint); --card-color-2: #c5f4e5; }
    .product-card-v3.category-makeup { --card-color-1: var(--lavender); --card-color-2: #e0d9fe; }
    .product-card-v3.category-fragrance { --card-color-1: var(--butter); --card-color-2: #fef9e3; }
    .product-card-v3.category-haircare { --card-color-1: var(--rose-cream); --card-color-2: #fbe6eb; }
    .product-card-v3.category-body-bath { --card-color-1: var(--blush); --card-color-2: #ffeef5; }


    .cute-divider {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: .5rem;
      margin: .5rem 0 0;
      opacity: .65
    }

    .cute-divider::after,
    .cute-divider::before {
      content: "";
      height: 1px;
      width: 36px;
      background: linear-gradient(90deg, transparent, var(--rose-gold), transparent)
    }

    .cute-divider .star {
      font-size: 12px;
      color: var(--rose-gold)
    }
    
    .loader {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--cream);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      transition: opacity .4s ease
    }

    /* --- ✨ SHARPER MARKET PAGE STYLES ✨ --- */
    #shop-sidebar {
        /* ✨ CHANGED: Using cream for a softer look that still contrasts with the white content area */
        background-color: var(--cream);
        border-left: 1px solid var(--border-color);
        transition: transform .4s cubic-bezier(.23, 1, .32, 1);
    }

    @media (max-width: 1024px) {
        #shop-sidebar {
            position: fixed; top: 0; right: 0; width: 85%; max-width: 340px;
            height: 100%; z-index: 70; transform: translateX(100%);
            border-left: none; box-shadow: -10px 0 30px rgba(0, 0, 0, .1);
        }
        #shop-sidebar.is-active { transform: translateX(0); }
    }

    .filter-group-title {
        display: flex; align-items: center; gap: 0.5rem; font-weight: 700;
        font-size: 1.1rem; color: var(--deep-brown); padding-bottom: 0.75rem;
        margin-bottom: 1rem; border-bottom: 1px solid var(--border-color);
    }
    .filter-group-title i { color: var(--primary-sharp); }

    .cute-checkbox { display: flex; align-items: center; gap: 0.75rem; position: relative; }
    .cute-checkbox input { position: absolute; opacity: 0; width: 0; height: 0; }
    .cute-checkbox .checkmark {
        width: 20px; height: 20px; border: 2px solid var(--rose-cream);
        border-radius: 6px; background-color: #fff;
        transition: all .3s ease;
        display: flex; align-items: center; justify-content: center;
    }
    .cute-checkbox .checkmark svg {
        width: 12px; height: 12px; color: white;
        stroke-width: 3; opacity: 0; transform: scale(0.5);
        transition: all .3s ease;
    }
    .cute-checkbox input:checked ~ .checkmark {
        background-color: var(--primary-sharp); border-color: var(--primary-sharp);
    }
    .cute-checkbox input:checked ~ .checkmark svg { opacity: 1; transform: scale(1); }
    .cute-checkbox:hover .checkmark { border-color: var(--primary-sharp); }
    .cute-checkbox label { color: var(--deep-brown); opacity: 0.9; }

    .price-range-slider { position: relative; height: 5px; background-color: var(--rose-cream); border-radius: 5px; margin: 1.5rem 0.5rem 1rem; }
    .price-range-slider .progress { position: absolute; height: 100%; background-color: var(--primary-sharp); border-radius: 5px; right: 0; left: 0; }
    .range-input { position: relative; }
    .range-input input {
        position: absolute; top: -5px; height: 5px; width: 100%;
        -webkit-appearance: none; appearance: none;
        background: none; pointer-events: none;
    }
    input[type="range"]::-webkit-slider-thumb {
        height: 18px; width: 18px; border-radius: 50%;
        background: var(--primary-sharp); border: 3px solid #fff;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        -webkit-appearance: none; appearance: none; pointer-events: auto;
    }
    input[type="range"]::-moz-range-thumb {
        height: 18px; width: 18px; border-radius: 50%;
        background: var(--primary-sharp); border: 3px solid #fff;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        -moz-appearance: none; appearance: none; pointer-events: auto;
    }

    .pagination-cute {
        display: flex; justify-content: center; align-items: center;
        gap: 0.5rem; margin-top: 3rem;
    }
    .pagination-cute a, .pagination-cute span {
        display: flex; align-items: center; justify-content: center;
        width: 40px; height: 40px; border-radius: 12px;
        font-weight: 600; text-decoration: none;
        background: #fff; color: var(--deep-brown);
        border: 1px solid var(--rose-cream);
        transition: all .3s cubic-bezier(.175, .885, .32, 1.275);
    }
    .pagination-cute a:hover {
        background: var(--accent); color: var(--primary-sharp);
        transform: translateY(-3px); border-color: var(--primary-sharp);
    }
    .pagination-cute span.current {
        /* ✨ CHANGED: Sharper active state */
        background: var(--primary-sharp); color: #fff;
        border-color: var(--primary-sharp); font-weight: 700;
        box-shadow: 0 8px 20px -8px var(--primary-sharp);
        transform: translateY(-2px);
    }
    .pagination-cute a.arrow { background: transparent; border: none; }
    .pagination-cute a.arrow:hover { background: var(--accent); }

    .sort-select {
        -webkit-appearance: none; -moz-appearance: none; appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23d96690' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: left 0.75rem center;
        padding-left: 2.5rem;
    }

    /* ✨ NEW: Sparkle animation for the hero */
    .sparkle-container {
      position: absolute;
      inset: 0;
      overflow: hidden;
      pointer-events: none;
    }
    .sparkle {
      position: absolute;
      width: 3px; height: 3px;
      background: rgba(255, 255, 255, 0.8);
      border-radius: 50%;
      animation: sparkle-float linear infinite;
      filter: blur(0.5px);
    }
    @keyframes sparkle-float {
      0% { transform: translateY(100vh) scale(0.5); opacity: 0; }
      10%, 90% { opacity: 1; }
      100% { transform: translateY(-10vh) scale(1); opacity: 0; }
    }
  </style>
</head>

<body>
  <div class="loader" id="loader"></div>
  <div class="cursor"></div>
  <div class="cursor-follower"></div>
  
  <nav class="fixed w-full z-50 transition-all duration-300" id="navbar">
    <div class="container mx-auto px-6 py-5">
      <div class="flex items-center justify-between" dir="ltr">
        <a href="/" class="text-3xl font-serif font-bold tracking-wider z-50">KOALAW</a>
        <div class="hidden lg:flex items-center gap-x-10 flex-row-reverse">
            <a href="/shop.html" class="nav-link">فروشگاه</a>
            <a href="/#collections" class="nav-link">کالکشن ها</a>
            <a href="/#brands" class="nav-link">برندها</a>
            <a href="/#magazine" class="nav-link">مجله</a>
            <a href="/#about" class="nav-link">درباره ما</a>
        </div>
        <div class="flex items-center gap-x-6">
          <button class="transition-all duration-300 hover:scale-110"><i data-feather="search" class="w-5 h-5"></i></button>
          <button class="transition-all duration-300 hover:scale-110"><i data-feather="user" class="w-5 h-5"></i></button>
          <button class="relative transition-all duration-300 hover:scale-110">
            <i data-feather="shopping-bag" class="w-5 h-5"></i>
            <span class="absolute -top-2 -right-2 bg-gradient-to-r from-rose-500 to-pink-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">۳</span>
          </button>
          <button id="mobile-menu-button" class="hamburger-button lg:hidden"><span></span><span></span><span></span></button>
        </div>
      </div>
    </div>
  </nav>

  <div id="mobile-menu">
    <a href="/shop.html" class="nav-link">فروشگاه</a>
    <a href="/#collections" class="nav-link">کالکشن ها</a>
    <a href="/#brands" class="nav-link">برندها</a>
    <a href="/#magazine" class="nav-link">مجله</a>
    <a href="/#about" class="nav-link">درباره ما</a>
  </div>
  <div id="mobile-menu-overlay" class="mobile-menu-overlay"></div>
  
  <main class="pt-24">
    <!-- Shop Hero Section -->
    <section class="py-20 lg:py-28 relative text-center overflow-hidden bg-gradient-to-b from-rose-100 to-cream">
        <div class="absolute inset-0 opacity-40">
            <div class="absolute top-0 right-0 w-64 h-64 bg-rose-200 rounded-full blur-3xl"></div>
            <div class="absolute bottom-0 left-0 w-72 h-72 bg-lavender/80 rounded-full blur-3xl"></div>
        </div>
        <!-- ✨ NEW: Added sparkle container -->
        <div class="sparkle-container" id="sparkle-container"></div>
        <div class="container mx-auto px-6 relative z-10">
            <div data-aos="fade-up">
                <h1 class="text-4xl lg:text-5xl font-serif font-bold mb-4">فروشگاه رویاها</h1>
                <div class="cute-divider"><span class="star">✦</span></div>
                <p class="text-gray-600 max-w-xl mx-auto text-lg mt-4">گنجینه زیبایی خود را بیابید. هر محصول با عشق و دقت برای درخشش شما انتخاب شده است.</p>
            </div>
        </div>
    </section>

    <!-- ✨ NEW: Main content wrapper for a layered, sharper look -->
    <div class="container mx-auto px-6 relative z-10 -mt-12">
        <div class="bg-white rounded-3xl shadow-xl shadow-rose-100/50 border border-rose-100/50 p-4 sm:p-6 lg:p-8">
            <div class="flex flex-row-reverse lg:gap-x-8">

                <!-- Filter Sidebar -->
                <aside id="shop-sidebar" class="w-full lg:w-1/4 lg:max-w-xs lg:sticky top-28 self-start h-screen lg:h-auto overflow-y-auto lg:overflow-visible pb-24 lg:pb-0 rounded-2xl">
                    <div class="p-6">
                        <div class="flex items-center justify-between lg:hidden mb-6">
                            <h3 class="font-bold text-xl">فیلتر محصولات</h3>
                            <button id="close-filter-btn" class="p-2 -m-2"><i data-feather="x" class="w-6 h-6"></i></button>
                        </div>
                        
                        <!-- Category Filter -->
                        <div class="mb-8">
                            <h4 class="filter-group-title"><i data-feather="grid"></i><span>دسته‌بندی</span></h4>
                            <div class="space-y-4">
                                <label class="cute-checkbox"><input type="checkbox" name="category" value="skincare"><span class="checkmark"><i data-feather="check"></i></span><span>مراقبت از پوست</span></label>
                                <label class="cute-checkbox"><input type="checkbox" name="category" value="makeup"><span class="checkmark"><i data-feather="check"></i></span><span>آرایش</span></label>
                                <label class="cute-checkbox"><input type="checkbox" name="category" value="fragrance"><span class="checkmark"><i data-feather="check"></i></span><span>عطر</span></label>
                                <label class="cute-checkbox"><input type="checkbox" name="category" value="haircare"><span class="checkmark"><i data-feather="check"></i></span><span>مراقبت از مو</span></label>
                                <label class="cute-checkbox"><input type="checkbox" name="category" value="body-bath"><span class="checkmark"><i data-feather="check"></i></span><span>بدن و حمام</span></label>
                            </div>
                        </div>

                        <!-- Price Filter -->
                        <div class="mb-8">
                            <h4 class="filter-group-title"><i data-feather="dollar-sign"></i><span>محدوده قیمت</span></h4>
                            <div class="price-range-slider">
                                <div class="progress"></div>
                            </div>
                            <div class="range-input">
                                <input type="range" class="range-min" min="0" max="1000000" value="100000" step="10000">
                                <input type="range" class="range-max" min="0" max="1000000" value="800000" step="10000">
                            </div>
                            <div class="flex justify-between items-center mt-6 text-sm text-gray-600">
                                <span id="price-min-display">۱۰۰,۰۰۰ تومان</span>
                                <span id="price-max-display">۸۰۰,۰۰۰ تومان</span>
                            </div>
                        </div>

                    </div>
                </aside>

                <!-- Products Grid -->
                <div class="w-full lg:w-3/4">
                    <div class="flex items-center justify-between mb-8 px-4 py-3 rounded-2xl bg-cream/50 border border-rose-100">
                        <button id="open-filter-btn" class="lg:hidden flex items-center gap-2 font-semibold text-sm">
                            <i data-feather="filter" class="w-5 h-5 text-primary-sharp"></i><span>فیلتر</span>
                        </button>
                        <div class="hidden lg:block"><p class="text-sm text-gray-600">نمایش <span class="font-bold">۱۲</span> از <span class="font-bold">۷۴</span> محصول</p></div>
                        <div class="relative">
                            <select class="sort-select bg-transparent font-semibold text-sm border-none focus:ring-0">
                                <option>مرتب‌سازی: جدیدترین</option>
                                <option>محبوب‌ترین</option>
                                <option>قیمت: کم به زیاد</option>
                                <option>قیمت: زیاد به کم</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="shop-product-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6">
                        <!-- Product cards will be injected here by JavaScript -->
                    </div>

                    <!-- Pagination -->
                    <nav aria-label="Pagination" class="pagination-cute">
                        <a href="#" class="arrow"><i data-feather="chevron-right"></i></a>
                        <a href="#">۱</a>
                        <span class="current">۲</span>
                        <a href="#">۳</a>
                        <a href="#">۴</a>
                        <span class="text-gray-400">...</span>
                        <a href="#">۱۰</a>
                        <a href="#" class="arrow"><i data-feather="chevron-left"></i></a>
                    </nav>
                </div>
            </div>
        </div>
    </div>
    
  </main>

  <footer class="bg-gradient-to-b from-gray-900 to-black text-white py-20 mt-24">
    <div class="container mx-auto px-6 text-center text-gray-400">
        <p class="text-sm">© ۲۰۲۴ D.AI — تمام حقوق محفوظ است.</p>
    </div>
  </footer>
  <button id="backToTop" class="fixed bottom-8 left-8 bg-gradient-to-r from-gray-900 to-black text-white p-4 rounded-full shadow-lg opacity-0 invisible transition-all duration-300 hover:shadow-xl transform hover:scale-110 z-40"><i data-feather="arrow-up" class="w-5 h-5"></i></button>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // --- CORE & ORIGINAL SCRIPTS ---
      AOS.init({ duration: 600, easing: "ease-out-cubic", once: true, offset: 40 });
      feather.replace();

      // Custom Cursor Logic
      const cur = document.querySelector(".cursor"), cFol = document.querySelector(".cursor-follower");
      if (window.innerWidth > 768) {
          let cX = 0, cY = 0, fX = 0, fY = 0, speed = 0.5;
          document.addEventListener("mousemove", e => { cX = e.clientX; cY = e.clientY; });
          function animateCursor() {
              cur.style.left = cX + "px"; cur.style.top = cY + "px";
              fX += (cX - fX) * speed; fY += (cY - fY) * speed;
              cFol.style.left = fX + "px"; cFol.style.top = fY + "px";
              requestAnimationFrame(animateCursor);
          }
          animateCursor();
          document.querySelectorAll("a, button, input[type='checkbox'], input[type='range']").forEach(el => {
              el.addEventListener("mouseenter", () => { cur.classList.add("hover"); cFol.style.transform = "translate(-50%,-50%) scale(1.5)"; });
              el.addEventListener("mouseleave", () => { cur.classList.remove("hover"); cFol.style.transform = "translate(-50%,-50%) scale(1)"; });
          });
      } else {
          [cur, cFol].forEach(el => el.style.display = "none");
      }

      // Loader
      window.addEventListener("load", () => setTimeout(() => { const e = document.getElementById("loader"); e.style.opacity = "0"; setTimeout(() => e.style.display = "none", 400); }, 500));
      
      // Navbar Scroll & Back to Top Button
      const nav = document.getElementById("navbar"), btt = document.getElementById("backToTop");
      let lastScroll = 0;
      window.addEventListener("scroll", () => {
        const scrollY = window.pageYOffset;
        nav.style.transform = scrollY > lastScroll && scrollY > 500 ? "translateY(-100%)" : "translateY(0)";
        btt.style.opacity = scrollY > 500 ? "1" : "0";
        btt.style.visibility = scrollY > 500 ? "visible" : "hidden";
        lastScroll = scrollY;
      });
      btt.addEventListener("click", () => window.scrollTo({ top: 0, behavior: "smooth" }));

      // Mobile Menu Toggle
      const mB = document.getElementById('mobile-menu-button'), mM = document.getElementById('mobile-menu'), mO = document.getElementById('mobile-menu-overlay');
      const toggleMobileMenu = () => {
          mB.classList.toggle('is-active'); mM.classList.toggle('is-active');
          mO.classList.toggle('is-active'); document.body.classList.toggle('mobile-menu-open');
      };
      mB?.addEventListener('click', toggleMobileMenu);
      mO?.addEventListener('click', toggleMobileMenu);

      // --- ✨ SHARPER MARKET PAGE SCRIPTS ✨ ---
      
      // Sparkle generation
      const sparkleContainer = document.getElementById('sparkle-container');
      if (sparkleContainer) {
          for (let i = 0; i < 20; i++) {
              const sparkle = document.createElement('div');
              sparkle.className = 'sparkle';
              sparkle.style.left = `${Math.random() * 100}%`;
              sparkle.style.animationDuration = `${5 + Math.random() * 10}s`;
              sparkle.style.animationDelay = `${Math.random() * 5}s`;
              sparkleContainer.appendChild(sparkle);
          }
      }

      // Dummy Product Data
      const products = [
        { d: "0", c: "skincare", t: "اکسیر درخشش طلایی", p: 480000, r: 4.8 },
        { d: "100", c: "makeup", t: "بوسه مخملی مات", p: 320000, r: 4.5 },
        { d: "200", c: "makeup", t: "پایه ابریشمی بی‌نقص", p: 420000, r: 4.9 },
        { d: "300", c: "fragrance", t: "راز نیمه‌شب", p: 780000, r: 4.7 },
        { d: "0", c: "skincare", t: "کرم شب بازسازی کننده", p: 550000, r: 4.6 },
        { d: "100", c: "haircare", t: "سرم موی آرگان", p: 290000, r: 4.8 },
        { d: "200", c: "body-bath", t: "اسکراب بدن شکری", p: 210000, r: 4.4 },
        { d: "300", c: "makeup", t: "پالت سایه کهکشانی", p: 650000, r: 4.9 },
        { d: "0", c: "fragrance", t: "عطر شکوفه بهاری", p: 710000, r: 4.5 },
        { d: "100", c: "skincare", t: "تونر گل رز آبرسان", p: 190000, r: 4.7 },
        { d: "200", c: "body-bath", t: "کره بدن وانیلی", p: 250000, r: 4.6 },
        { d: "300", c: "haircare", t: "ماسک موی کراتینه", p: 380000, r: 4.8 },
      ];

      const productGrid = document.getElementById('shop-product-grid');

      function createProductCard(p) {
          const categoryIcon = { 'skincare': 'shield', 'makeup': 'pen-tool', 'fragrance': 'wind', 'haircare': 'git-branch', 'body-bath': 'droplet' }[p.c] || 'gift';
          const price = p.p.toLocaleString('fa-IR') + ' تومان';
          const rating = p.r.toLocaleString('fa-IR', { minimumFractionDigits: 1, maximumFractionDigits: 1 });
          const stars = Array(Math.floor(p.r)).fill(0).map(() => `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-star"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>`).join('');

          return `
            <a href="#" class="product-card-v3 category-${p.c}" data-aos="fade-up" data-aos-delay="${p.d}">
              <div class="card-bg"></div>
              <div class="card-blob">
                <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg"><path d="M48.1,-58.9C62.2,-51.9,73.4,-37.2,77,-21.2C80.6,-5.2,76.5,12.2,68.4,26.1C60.3,40,48.2,50.4,34.5,58.3C20.8,66.2,5.5,71.6,-9.3,71.1C-24.1,70.7,-38.4,64.4,-50.9,54.7C-63.4,44.9,-74,31.7,-77.8,16.5C-81.6,1.2,-78.6,-16,-69.8,-29.3C-61,-42.6,-46.4,-52,-32.1,-59.5C-17.8,-67,-3.9,-72.6,9.6,-71.7C23.1,-70.8,48.1,-58.9,48.1,-58.9Z" transform="translate(100 100)"></path></svg>
              </div>
              <div class="card-image-wrapper"><img src="./image/product.png" alt="${p.t}" class="card-image"></div>
              <div class="card-content">
                <div class="card-category"><i data-feather="${categoryIcon}" class="w-3 h-3"></i><span>${p.c}</span></div>
                <h3 class="card-title">${p.t}</h3>
                <div class="card-rating">${stars}<span>${rating}</span></div>
                <p class="card-price">${price}</p>
              </div>
            </a>
          `;
      }

      if (productGrid) {
          productGrid.innerHTML = products.map(p => createProductCard(p)).join('');
          feather.replace(); // Re-run for new icons
      }

      // Filter Sidebar Logic
      const openFilterBtn = document.getElementById('open-filter-btn');
      const closeFilterBtn = document.getElementById('close-filter-btn');
      const shopSidebar = document.getElementById('shop-sidebar');
      const filterOverlay = document.createElement('div');
      filterOverlay.className = 'mobile-menu-overlay'; 
      document.body.appendChild(filterOverlay);
      const toggleFilterMenu = () => {
          shopSidebar.classList.toggle('is-active');
          filterOverlay.classList.toggle('is-active');
          document.body.classList.toggle('filter-menu-open');
      };
      openFilterBtn?.addEventListener('click', toggleFilterMenu);
      closeFilterBtn?.addEventListener('click', toggleFilterMenu);
      filterOverlay.addEventListener('click', toggleFilterMenu);

      // Price Range Slider Logic
      const rangeInputs = document.querySelectorAll('.range-input input');
      const progress = document.querySelector('.price-range-slider .progress');
      const priceMinDisplay = document.getElementById('price-min-display');
      const priceMaxDisplay = document.getElementById('price-max-display');
      if(rangeInputs.length > 0) {
        rangeInputs.forEach(input => {
            input.addEventListener("input", e => {
                let minVal = parseInt(rangeInputs[0].value), maxVal = parseInt(rangeInputs[1].value);
                if ((maxVal - minVal) < 100000) {
                    if (e.target.className === "range-min") rangeInputs[0].value = maxVal - 100000;
                    else rangeInputs[1].value = minVal + 100000;
                } else {
                    progress.style.right = (minVal / rangeInputs[0].max) * 100 + '%';
                    progress.style.left = 100 - (maxVal / rangeInputs[1].max) * 100 + '%';
                    priceMinDisplay.textContent = minVal.toLocaleString('fa-IR') + ' تومان';
                    priceMaxDisplay.textContent = maxVal.toLocaleString('fa-IR') + ' تومان';
                }
            });
        });
      }
    });
  </script>
</body>
</html>